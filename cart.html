<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panier - ETLALA</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;800&family=Lato:wght@400;500;600;700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800&display=swap" />

  <!-- Shared styles -->
  <link rel="stylesheet" href="./frontend/style/style.css" />
  <link rel="stylesheet" href="./frontend/style/navbar-styles.css" />
  <link rel="stylesheet" href="./frontend/style/navbar-dropdown.css" />
  <link rel="stylesheet" href="./frontend/style/footer-styles.css" />
  <link rel="stylesheet" href="./frontend/style/minas-colors.css" />

  <style>
    :root { --brand-green: #6E8B72; --brand-gold: #D4AF37; --ink: #222; --muted: #666; --line: #e6e2da; }
    body { background: #faf8f3; }

    .cart-page { padding: 110px 20px 40px; }
    .cart-container { max-width: 1200px; margin: 0 auto; }
    .cart-title { font: 700 36px/1.15 Playfair Display, serif; color: var(--brand-green); margin: 0 0 28px; }
    .cart-grid { display: grid; grid-template-columns: 1fr 400px; gap: 40px; align-items: start; }
    @media (max-width: 980px) { .cart-grid { grid-template-columns: 1fr; } }

    .cart-card { background: #fff; border: 1px solid var(--line); border-radius: 14px; padding: 24px; }

    .cart-items { display: grid; gap: 16px; }
    .cart-item { display: grid; grid-template-columns: 110px 1fr auto; gap: 20px; align-items: center; padding: 14px; border: 1px solid var(--line); border-radius: 14px; background: #fff; }
    .cart-item img { width: 110px; height: 110px; object-fit: cover; border-radius: 12px; }
    .cart-item-name { font: 600 16px/1.4 Lato, sans-serif; color: var(--ink); margin: 0 0 6px; }
    .cart-item-meta { font: 400 13px/1.5 Lato, sans-serif; color: var(--muted); }

    .cart-qty { display: inline-flex; align-items: center; gap: 10px; border: 1px solid var(--line); border-radius: 10px; padding: 8px 10px; }
    .cart-qty-btn { -webkit-appearance: none; appearance: none; background: transparent; border: none; width: 26px; height: 26px; border-radius: 6px; cursor: pointer; color: var(--brand-green); font-weight: 700; font-size: 16px; }
    .cart-qty-val { min-width: 26px; text-align: center; font: 600 14px Lato, sans-serif; color: var(--ink); }

    .cart-price-col { text-align: right; }
    .cart-line { font: 700 16px Lato, sans-serif; color: var(--ink); }
    .cart-remove { display: inline-block; margin-top: 10px; font: 13px Lato, sans-serif; color: #9a3d3d; text-decoration: none; cursor: pointer; }

    .cart-empty { padding: 18px; background: #fff; border: 1px dashed var(--line); border-radius: 12px; color: var(--muted); text-align: center; }
    .cart-empty .btn { display: inline-block; margin-top: 8px; }

    .summary-title { font: 600 17px/1.25 Lato, sans-serif; letter-spacing: .06em; color: var(--ink); text-transform: uppercase; margin: 8px 0 18px; }
    .sum-row { display: flex; align-items: center; justify-content: space-between; font: 600 15px Lato, sans-serif; color: var(--ink); }
    .sum-row.muted { color: var(--muted); font-weight: 500; }
    .sum-total { font: 800 20px Lato, sans-serif; }

    .btn { background: var(--brand-gold); color: #5a7260; border: none; padding: 14px 18px; border-radius: 12px; font: 700 13px Lato, sans-serif; letter-spacing: .08em; text-transform: uppercase; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; }
    .btn.secondary { background: transparent; color: var(--brand-green); border: 1px solid var(--brand-green); }

    .actions { margin-top: 16px; display: flex; gap: 14px; flex-wrap: wrap; }

    /* Responsive refinements */
    @media (max-width: 980px) {
      .cart-item { grid-template-columns: 90px 1fr auto; gap: 16px; padding: 12px; }
      .cart-item img { width: 90px; height: 90px; }
    }
    @media (max-width: 640px) {
      .cart-grid { gap: 20px; }
      .cart-card { padding: 16px; }
      .cart-item { grid-template-columns: 72px 1fr auto; gap: 12px; padding: 10px; }
      .cart-item img { width: 72px; height: 72px; }
      .cart-item-name { font: 600 15px/1.35 Lato, sans-serif; }
      .cart-item-meta { font: 400 12px/1.4 Lato, sans-serif; }
      .cart-qty { gap: 6px; padding: 6px 8px; }
      .cart-qty-btn { width: 22px; height: 22px; font-size: 14px; }
      .cart-qty-val { min-width: 20px; font: 600 13px Lato, sans-serif; }
      .btn { width: 100%; }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="minimal-navbar">
    <div class="navbar-left">
      <button class="hamburger-menu" id="hamburger-btn" aria-label="Menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 12H21M3 6H21M3 18H21" stroke="#6E8B72" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <button class="search-btn" aria-label="Rechercher">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="8" stroke="#6E8B72" stroke-width="2"/>
          <path d="M21 21L16.65 16.65" stroke="#6E8B72" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="search-text">RECHERCHER</span>
      </button>
    </div>
    <div class="navbar-center">
      <a href="/" class="brand-logo">
        <img src="./frontend/public/logo.png" alt="ETLALA" />
      </a>
    </div>
    <div class="navbar-right">
      <a href="/login" class="nav-link">CONNEXION / INSCRIPTION</a>
      <a href="#" class="account-icon" aria-label="Compte">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="8" r="4" stroke="#6E8B72" stroke-width="2"/>
          <path d="M5 20C5 16.134 8.134 13 12 13C15.866 13 19 16.134 19 20" stroke="#6E8B72" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </a>
      <a href="#" class="cart-link">
        <span class="cart-text">PANIER</span>
        <span class="cart-badge">0</span>
      </a>
    </div>
  </nav>

  <!-- Navbar Dropdown Overlay and Cart Dropdown -->
  <div class="navbar-dropdown-overlay"></div>
  <div class="navbar-dropdown cart-dropdown" id="cart-dropdown">
    <div class="dropdown-header">
      <h3 class="dropdown-title">Panier</h3>
      <button class="dropdown-close" data-dropdown="cart">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <div class="dropdown-body">
      <div class="cart-items" id="dd-cart-items"></div>
      <div class="cart-empty" id="dd-cart-empty">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 2L7.17 4H3C1.9 4 1 4.9 1 6V18C1 19.1 1.9 20 3 20H21C22.1 20 23 19.1 23 18V6C23 4.9 22.1 4 21 4H16.83L15 2H9Z" stroke="#6E8B72" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <p>Votre panier est vide</p>
        <a href="/products.html" class="shop-now-btn">Acheter maintenant</a>
      </div>
    </div>
    <div class="dropdown-footer" id="dd-cart-footer">
      <div class="cart-total">
        <span class="total-label">Sous-total :</span>
        <span class="total-amount" id="dd-cart-total">$0.00</span>
      </div>
      <div class="cart-actions">
        <a href="/cart.html" class="btn-view-cart">Voir le panier</a>
        <a href="/checkout.html" class="btn-checkout">Passer au paiement</a>
      </div>
    </div>
  </div>

  <!-- Sidebar Menu (from main.js) -->
  <div class="sidebar-overlay"></div>
  <aside class="sidebar-menu">
    <div class="sidebar-header">
      <button class="sidebar-back" aria-label="Retour">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="sidebar-back-text">Retour</span>
      </button>
      <nav class="sidebar-header-nav">
        <a href="/" class="sidebar-header-link">Accueil</a>
        <a href="/gift-card" class="sidebar-header-link">Carte cadeau</a>
        <a href="/store-locator.html" class="sidebar-header-link">Trouver une boutique</a>
        <a href="/contact.html" class="sidebar-header-link">Nous contacter</a>
      </nav>
      <button class="sidebar-close" aria-label="Fermer le menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </aside>

  <!-- Cart Content -->
  <div class="cart-page">
    <div class="cart-container">
      <h1 class="cart-title">Votre panier</h1>
      <div class="cart-grid">
        <div class="cart-card">
          <div id="cart-items" class="cart-items"></div>
          <div id="cart-empty" class="cart-empty" style="display:none;">
            Votre panier est vide.<br/>
            <a href="/products.html" class="btn secondary" style="margin-top:10px;">Acheter maintenant</a>
          </div>
        </div>
        <aside>
          <div class="cart-card">
            <div class="summary-title">RÃ©capitulatif de commande</div>
            <div class="sum-row muted"><span>Sous-total</span><span id="sum-subtotal">0 DH</span></div>
            <div class="sum-row muted"><span>Livraison</span><span id="sum-shipping">CalculÃ© lors du paiement</span></div>
            <div class="sum-row sum-total" style="margin-top:10px;"><span>Total</span><span id="sum-total">0 DH</span></div>
            <div class="actions">
              <a href="/checkout.html" class="btn" id="to-checkout">Passer au paiement</a>
              <a href="/products.html" class="btn secondary">Continuer vos achats</a>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- Footer anchor (main.js auto-injects footer-component.html) -->
  <div id="footer-container"></div>

  <!-- Scripts -->
  <script src="./frontend/src/main.js"></script>
  <script src="./frontend/src/navbar-dropdown.js"></script>
  <script>
    (function(){
      function readCart(){ try { return JSON.parse(localStorage.getItem('etlala_cart')||'[]'); } catch(e){ return []; } }
      function normalize(cart){ return cart.map(it => ({...it, quantity: it.quantity != null ? it.quantity : (it.qty != null ? it.qty : 1), price: Number(it.price||0), image: it.image || './frontend/public/logo.png'})); }
      function isDH(cart){ return cart.some(i => (i.currency||'').toUpperCase()==='DH'); }
      function money(v, dh){ return dh ? `${v.toFixed(0)} DH` : `$${v.toFixed(2)}`; }

      function render(){
        let cart = normalize(readCart());
        const dh = isDH(cart);
        const wrap = document.getElementById('cart-items');
        const empty = document.getElementById('cart-empty');
        const subEl = document.getElementById('sum-subtotal');
        const totEl = document.getElementById('sum-total');

        if (!wrap) return;
        if (cart.length === 0){
          wrap.style.display = 'none';
          empty.style.display = 'block';
          subEl.textContent = dh ? '0 DH' : '$0.00';
          totEl.textContent = dh ? '0 DH' : '$0.00';
          return;
        }
        wrap.style.display = 'grid';
        empty.style.display = 'none';

        const subtotal = cart.reduce((s,it)=> s + (it.price * it.quantity), 0);

        wrap.innerHTML = cart.map(it => `
          <div class="cart-item" data-id="${it.id}">
            <img src="${it.image}" alt="${it.name}" />
            <div>
              <div class="cart-item-name">${it.name}</div>
              <div class="cart-item-meta">${(it.currency||'').toUpperCase()==='DH' ? `${it.price.toFixed(0)} DH` : `${it.price.toFixed(2)}`} Â· Taille : ${it.size || 'â'}</div>
              <div class="cart-qty">
                <button class="cart-qty-btn btn-dec" aria-label="Diminuer">-</button>
                <span class="cart-qty-val">${it.quantity}</span>
                <button class="cart-qty-btn btn-inc" aria-label="Augmenter">+</button>
              </div>
              <a class="cart-remove">Supprimer</a>
            </div>
            <div class="cart-price-col">
              <div class="cart-line">${money(it.price * it.quantity, dh)}</div>
            </div>
          </div>
        `).join('');

        subEl.textContent = money(subtotal, dh);
        totEl.textContent = money(subtotal, dh);

        attachHandlers();
      }

      function save(cart){ localStorage.setItem('etlala_cart', JSON.stringify(cart)); if (typeof window.updateCartBadge==='function') window.updateCartBadge(); if (typeof window.updateCartDropdown==='function') window.updateCartDropdown(); }

      function getId(node){ return node.closest('.cart-item')?.getAttribute('data-id'); }

      function attachHandlers(){
        document.querySelectorAll('.btn-inc').forEach(b=> b.addEventListener('click', function(){
          const id = getId(this); let cart = normalize(readCart()); const idx = cart.findIndex(x => String(x.id)===String(id)); if (idx>-1){ cart[idx].quantity += 1; save(cart); render(); }
        }));
        document.querySelectorAll('.btn-dec').forEach(b=> b.addEventListener('click', function(){
          const id = getId(this); let cart = normalize(readCart()); const idx = cart.findIndex(x => String(x.id)===String(id)); if (idx>-1){ cart[idx].quantity = Math.max(0, cart[idx].quantity - 1); if (cart[idx].quantity===0) cart.splice(idx,1); save(cart); render(); }
        }));
        document.querySelectorAll('.cart-remove').forEach(b=> b.addEventListener('click', function(){
          const id = getId(this); let cart = normalize(readCart()).filter(x => String(x.id)!==String(id)); save(cart); render();
        }));
      }

      document.addEventListener('DOMContentLoaded', render);
    })();
  </script>
</body>
</html>
